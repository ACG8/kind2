<html><head>
<link rel="stylesheet" href="include/style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Unroller" rel="Chapter" href="Unroller.html">
<link title="Log" rel="Chapter" href="Log.html">
<link title="Event" rel="Chapter" href="Event.html">
<link title="Strategy" rel="Chapter" href="Strategy.html">
<link title="Analysis" rel="Chapter" href="Analysis.html">
<link title="Flags" rel="Chapter" href="Flags.html">
<link title="InvarManager" rel="Chapter" href="InvarManager.html">
<link title="Kind2" rel="Chapter" href="Kind2.html">
<link title="Kind2Flow" rel="Chapter" href="Kind2Flow.html">
<link title="PostAnalysis" rel="Chapter" href="PostAnalysis.html">
<link title="InputSystem" rel="Chapter" href="InputSystem.html">
<link title="Eval" rel="Chapter" href="Eval.html">
<link title="Ident" rel="Chapter" href="Ident.html">
<link title="Ltree" rel="Chapter" href="Ltree.html">
<link title="Model" rel="Chapter" href="Model.html">
<link title="Scope" rel="Chapter" href="Scope.html">
<link title="Simplify" rel="Chapter" href="Simplify.html">
<link title="StateVar" rel="Chapter" href="StateVar.html">
<link title="Symbol" rel="Chapter" href="Symbol.html">
<link title="TermAttr" rel="Chapter" href="TermAttr.html">
<link title="Term" rel="Chapter" href="Term.html">
<link title="Type" rel="Chapter" href="Type.html">
<link title="UfSymbol" rel="Chapter" href="UfSymbol.html">
<link title="Var" rel="Chapter" href="Var.html">
<link title="Property" rel="Chapter" href="Property.html">
<link title="SubSystem" rel="Chapter" href="SubSystem.html">
<link title="TransSys" rel="Chapter" href="TransSys.html">
<link title="Actlit" rel="Chapter" href="Actlit.html">
<link title="Base" rel="Chapter" href="Base.html">
<link title="Compress" rel="Chapter" href="Compress.html">
<link title="Step" rel="Chapter" href="Step.html">
<link title="Clause" rel="Chapter" href="Clause.html">
<link title="CooperQE" rel="Chapter" href="CooperQE.html">
<link title="Extract" rel="Chapter" href="Extract.html">
<link title="IC3" rel="Chapter" href="IC3.html">
<link title="Poly" rel="Chapter" href="Poly.html">
<link title="Presburger" rel="Chapter" href="Presburger.html">
<link title="QE" rel="Chapter" href="QE.html">
<link title="InvGenMiner" rel="Chapter" href="InvGenMiner.html">
<link title="InvGenDomain" rel="Chapter" href="InvGenDomain.html">
<link title="InvGenGraph" rel="Chapter" href="InvGenGraph.html">
<link title="InvGen" rel="Chapter" href="InvGen.html">
<link title="LockStepDriver" rel="Chapter" href="LockStepDriver.html">
<link title="InputParser" rel="Chapter" href="InputParser.html">
<link title="Interpreter" rel="Chapter" href="Interpreter.html">
<link title="LustreLexer" rel="Chapter" href="LustreLexer.html">
<link title="LustreParser" rel="Chapter" href="LustreParser.html">
<link title="LustreAst" rel="Chapter" href="LustreAst.html">
<link title="LustreIdent" rel="Chapter" href="LustreIdent.html">
<link title="LustreIndex" rel="Chapter" href="LustreIndex.html">
<link title="LustreExpr" rel="Chapter" href="LustreExpr.html">
<link title="LustreNode" rel="Chapter" href="LustreNode.html">
<link title="LustreContext" rel="Chapter" href="LustreContext.html">
<link title="LustreContract" rel="Chapter" href="LustreContract.html">
<link title="LustreDeclarations" rel="Chapter" href="LustreDeclarations.html">
<link title="LustreSimplify" rel="Chapter" href="LustreSimplify.html">
<link title="LustreSlicing" rel="Chapter" href="LustreSlicing.html">
<link title="LustreTransSys" rel="Chapter" href="LustreTransSys.html">
<link title="LustreInput" rel="Chapter" href="LustreInput.html">
<link title="LustrePath" rel="Chapter" href="LustrePath.html">
<link title="NativeInput" rel="Chapter" href="NativeInput.html">
<link title="Pretty" rel="Chapter" href="Pretty.html">
<link title="SMTExpr" rel="Chapter" href="SMTExpr.html">
<link title="SMTLIBSolver" rel="Chapter" href="SMTLIBSolver.html">
<link title="SMTSolver" rel="Chapter" href="SMTSolver.html">
<link title="SolverDriver" rel="Chapter" href="SolverDriver.html">
<link title="SolverResponse" rel="Chapter" href="SolverResponse.html">
<link title="SolverSig" rel="Chapter" href="SolverSig.html">
<link title="CVC4Driver" rel="Chapter" href="CVC4Driver.html">
<link title="GenericSMTLIBDriver" rel="Chapter" href="GenericSMTLIBDriver.html">
<link title="Z3Driver" rel="Chapter" href="Z3Driver.html">
<link title="Yices2SMT2Driver" rel="Chapter" href="Yices2SMT2Driver.html">
<link title="YicesDriver" rel="Chapter" href="YicesDriver.html">
<link title="YicesLexer" rel="Chapter" href="YicesLexer.html">
<link title="YicesNative" rel="Chapter" href="YicesNative.html">
<link title="YicesResponse" rel="Chapter" href="YicesResponse.html">
<link title="Debug" rel="Chapter" href="Debug.html">
<link title="Decimal" rel="Chapter" href="Decimal.html">
<link title="Hashcons" rel="Chapter" href="Hashcons.html">
<link title="HString" rel="Chapter" href="HString.html">
<link title="HStringSExpr" rel="Chapter" href="HStringSExpr.html">
<link title="Kind2Config" rel="Chapter" href="Kind2Config.html">
<link title="Lib" rel="Chapter" href="Lib.html">
<link title="Res" rel="Chapter" href="Res.html">
<link title="Messaging" rel="Chapter" href="Messaging.html">
<link title="Numeral" rel="Chapter" href="Numeral.html">
<link title="SExprBase" rel="Chapter" href="SExprBase.html">
<link title="SExprLexer" rel="Chapter" href="SExprLexer.html">
<link title="Stat" rel="Chapter" href="Stat.html">
<link title="TermLib" rel="Chapter" href="TermLib.html">
<link title="Trie" rel="Chapter" href="Trie.html">
<link title="Version" rel="Chapter" href="Version.html">
<link title="LustreToRust" rel="Chapter" href="LustreToRust.html">
<link title="TestgenDF" rel="Chapter" href="TestgenDF.html">
<link title="TestgenIO" rel="Chapter" href="TestgenIO.html">
<link title="TestgenModes" rel="Chapter" href="TestgenModes.html">
<link title="TestgenSolver" rel="Chapter" href="TestgenSolver.html">
<link title="TestgenStrategies" rel="Chapter" href="TestgenStrategies.html">
<link title="TestgenTree" rel="Chapter" href="TestgenTree.html">
<link title="TestgenLib" rel="Chapter" href="TestgenLib.html">
<link title="Certificate" rel="Chapter" href="Certificate.html"><title>Kind 2 Developer's Documentation : Kind2</title>
</head>
<body>
<code class="code"><span class="comment">(*&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;Kind&nbsp;2&nbsp;model&nbsp;checker.<br>
<br>
&nbsp;&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2015&nbsp;by&nbsp;the&nbsp;Board&nbsp;of&nbsp;Trustees&nbsp;of&nbsp;the&nbsp;University&nbsp;of&nbsp;Iowa<br>
<br>
&nbsp;&nbsp;&nbsp;Licensed&nbsp;under&nbsp;the&nbsp;Apache&nbsp;License,&nbsp;Version&nbsp;2.0&nbsp;(the&nbsp;"License");&nbsp;you<br>
&nbsp;&nbsp;&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.&nbsp;&nbsp;You<br>
&nbsp;&nbsp;&nbsp;may&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
<br>
&nbsp;&nbsp;&nbsp;http://www.apache.org/licenses/LICENSE-2.0&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;Unless&nbsp;required&nbsp;by&nbsp;applicable&nbsp;law&nbsp;or&nbsp;agreed&nbsp;to&nbsp;in&nbsp;writing,&nbsp;software<br>
&nbsp;&nbsp;&nbsp;distributed&nbsp;under&nbsp;the&nbsp;License&nbsp;is&nbsp;distributed&nbsp;on&nbsp;an&nbsp;"AS&nbsp;IS"&nbsp;BASIS,<br>
&nbsp;&nbsp;&nbsp;WITHOUT&nbsp;WARRANTIES&nbsp;OR&nbsp;CONDITIONS&nbsp;OF&nbsp;ANY&nbsp;KIND,&nbsp;either&nbsp;express&nbsp;or<br>
&nbsp;&nbsp;&nbsp;implied.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
&nbsp;&nbsp;&nbsp;permissions&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.&nbsp;<br>
<br>
*)</span><br>
<br>
</code><table><tr><td></td><td><span class="comment">(** Top level of the Kind 2 model-checker. *)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Lib</span><br>
<br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Signals</span>&nbsp;=&nbsp;<span class="constructor">TermLib</span>.<span class="constructor">Signals</span><br>
<br>
<span class="comment">(*&nbsp;Hide&nbsp;existential&nbsp;type&nbsp;parameter&nbsp;of&nbsp;to&nbsp;construct&nbsp;values&nbsp;of&nbsp;'a&nbsp;InputSystem.t<br>
&nbsp;&nbsp;&nbsp;at&nbsp;runtime&nbsp;*)</span><br>
<span class="keyword">type</span>&nbsp;any_input&nbsp;=<br>
<span class="keywordsign">|</span>&nbsp;<span class="constructor">Input</span>&nbsp;:&nbsp;<span class="keywordsign">'</span>a&nbsp;<span class="constructor">InputSystem</span>.t&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;any_input<br>
<br>
<br>
<span class="comment">(*&nbsp;Setup&nbsp;everything&nbsp;and&nbsp;returns&nbsp;the&nbsp;input&nbsp;system.&nbsp;Setup&nbsp;includes:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;debug&nbsp;setup,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;log&nbsp;level&nbsp;setup,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;smt&nbsp;solver&nbsp;setup,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;timeout&nbsp;setup,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;signal&nbsp;handling,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;starting&nbsp;global&nbsp;timer,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;parsing&nbsp;input&nbsp;file,<br>
&nbsp;&nbsp;&nbsp;-&nbsp;building&nbsp;input&nbsp;system.&nbsp;*)</span><br>
<span class="keyword">let</span>&nbsp;setup&nbsp;:&nbsp;unit&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;any_input&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Formatter&nbsp;to&nbsp;write&nbsp;debug&nbsp;output&nbsp;to.&nbsp;*)</span><br>
&nbsp;&nbsp;(<span class="keyword">match</span>&nbsp;<span class="constructor">Flags</span>.debug_log&nbsp;()&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Write&nbsp;to&nbsp;stdout&nbsp;by&nbsp;default.&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Open&nbsp;channel&nbsp;to&nbsp;given&nbsp;file&nbsp;and&nbsp;create&nbsp;formatter&nbsp;on&nbsp;channel.&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;f&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;<span class="keyword">try</span>&nbsp;open_out&nbsp;f&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Sys_error</span>&nbsp;msg&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Format</span>.sprintf<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"Could&nbsp;not&nbsp;open&nbsp;debug&nbsp;logfile&nbsp;\"%s\":&nbsp;\"%s\""</span>&nbsp;f&nbsp;msg<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&gt;&nbsp;failwith<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Debug</span>.set_formatter&nbsp;(<span class="constructor">Format</span>.formatter_of_out_channel&nbsp;oc)<br>
&nbsp;&nbsp;)&nbsp;;<br>
<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Record&nbsp;backtraces&nbsp;on&nbsp;log&nbsp;levels&nbsp;debug&nbsp;and&nbsp;higher.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;output_on_level&nbsp;<span class="constructor">L_debug</span>&nbsp;<span class="keyword">then</span>&nbsp;<span class="constructor">Printexc</span>.record_backtrace&nbsp;<span class="keyword">true</span>&nbsp;;<br>
<br>
&nbsp;&nbsp;<span class="comment">(*<br>
&nbsp;&nbsp;&nbsp;&nbsp;/!\&nbsp;==================================================================&nbsp;/!\<br>
&nbsp;&nbsp;&nbsp;&nbsp;/!\&nbsp;Must&nbsp;not&nbsp;use&nbsp;[vtalrm]&nbsp;signal,&nbsp;this&nbsp;is&nbsp;used&nbsp;internally&nbsp;by&nbsp;the&nbsp;OCaml&nbsp;/!\<br>
&nbsp;&nbsp;&nbsp;&nbsp;/!\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Threads]&nbsp;module.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/!\<br>
&nbsp;&nbsp;&nbsp;&nbsp;/!\&nbsp;==================================================================&nbsp;/!\<br>
&nbsp;&nbsp;*)</span><br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Raise&nbsp;exception&nbsp;on&nbsp;CTRL+C.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="constructor">Sys</span>.catch_break&nbsp;<span class="keyword">true</span>&nbsp;;<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Set&nbsp;sigalrm&nbsp;handler.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="constructor">Signals</span>.set_sigalrm_timeout_from_flag&nbsp;()&nbsp;;<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Install&nbsp;generic&nbsp;signal&nbsp;handlers&nbsp;for&nbsp;other&nbsp;signals.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="constructor">Signals</span>.set_sigint&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Signals</span>.set_sigpipe&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Signals</span>.set_sigterm&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Signals</span>.set_sigquit&nbsp;()&nbsp;;<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Starting&nbsp;global&nbsp;timer.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="constructor">Stat</span>.start_timer&nbsp;<span class="constructor">Stat</span>.total_time&nbsp;;<br>
<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;in_file&nbsp;=&nbsp;<span class="constructor">Flags</span>.input_file&nbsp;()&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_info</span>&nbsp;<span class="string">"Parsing&nbsp;%s."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">match</span>&nbsp;in_file&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"standard&nbsp;input"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"input&nbsp;file&nbsp;\""</span>&nbsp;^&nbsp;in_file&nbsp;^&nbsp;<span class="string">"\""</span>);<br>
<br>
&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;in_file&nbsp;|&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;<span class="constructor">Flags</span>.input_format&nbsp;()&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Lustre</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Input</span>&nbsp;(<span class="constructor">InputSystem</span>.read_input_lustre&nbsp;in_file)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Native</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Input</span>&nbsp;(<span class="constructor">InputSystem</span>.read_input_native&nbsp;in_file)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Horn</span>&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"Horn&nbsp;clauses&nbsp;are&nbsp;not&nbsp;supported."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.terminate_log&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit&nbsp;<span class="constructor">ExitCodes</span>.error<br>
&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="comment">(*&nbsp;Could&nbsp;not&nbsp;create&nbsp;input&nbsp;system.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">LustreAst</span>.<span class="constructor">Parser_error</span>&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Don't&nbsp;do&nbsp;anything&nbsp;for&nbsp;parser&nbsp;error,&nbsp;they&nbsp;should&nbsp;already&nbsp;have&nbsp;printed<br>
&nbsp;&nbsp;&nbsp;&nbsp;some&nbsp;stuff.&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.terminate_log&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;exit&nbsp;<span class="constructor">ExitCodes</span>.error<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;e&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;backtrace&nbsp;=&nbsp;<span class="constructor">Printexc</span>.get_raw_backtrace&nbsp;()&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"Error&nbsp;opening&nbsp;input&nbsp;file&nbsp;\"%s\":@&nbsp;%s%a"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Flags</span>.input_file&nbsp;())&nbsp;(<span class="constructor">Printexc</span>.to_string&nbsp;e)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">if</span>&nbsp;<span class="constructor">Printexc</span>.backtrace_status&nbsp;()&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;fmt&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Format</span>.fprintf&nbsp;fmt&nbsp;<span class="string">"@\nBacktrace:@&nbsp;%a"</span>&nbsp;print_backtrace<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;())&nbsp;backtrace;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Terminating&nbsp;log&nbsp;and&nbsp;exiting&nbsp;with&nbsp;error.&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.terminate_log&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;exit&nbsp;<span class="constructor">ExitCodes</span>.error&nbsp;&nbsp;<br>
<br>
<br>
<span class="comment">(*&nbsp;Entry&nbsp;point&nbsp;*)</span><br>
<span class="keyword">let</span>&nbsp;main&nbsp;()&nbsp;=<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Set&nbsp;everything&nbsp;up&nbsp;and&nbsp;produce&nbsp;input&nbsp;system.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="constructor">Input</span>&nbsp;input_sys&nbsp;=&nbsp;setup&nbsp;()&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Notify&nbsp;user&nbsp;of&nbsp;silent&nbsp;contract&nbsp;loading.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="constructor">InputSystem</span>.silent_contracts_of&nbsp;input_sys<br>
&nbsp;&nbsp;|&gt;&nbsp;<span class="constructor">List</span>.iter&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(_,&nbsp;[])&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(scope,contracts)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_note</span>&nbsp;<span class="string">"Silent&nbsp;contract%s&nbsp;loaded&nbsp;for&nbsp;system&nbsp;%a:&nbsp;@[&lt;v&gt;%a@]"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">if</span>&nbsp;1&nbsp;&lt;&nbsp;<span class="constructor">List</span>.length&nbsp;contracts&nbsp;<span class="keyword">then</span>&nbsp;<span class="string">"s"</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="string">""</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Scope</span>.pp_print_scope&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pp_print_list&nbsp;<span class="constructor">Format</span>.pp_print_string&nbsp;<span class="string">"@&nbsp;"</span>)&nbsp;contracts<br>
&nbsp;&nbsp;)&nbsp;;<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Not&nbsp;launching&nbsp;if&nbsp;we're&nbsp;just&nbsp;translating&nbsp;contracts.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;<span class="constructor">Flags</span>.<span class="constructor">Contracts</span>.translate_contracts&nbsp;()&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;target&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;src&nbsp;=&nbsp;<span class="constructor">Flags</span>.input_file&nbsp;()&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log_uncond&nbsp;<span class="string">"Translating&nbsp;contracts&nbsp;to&nbsp;file&nbsp;\"%s\""</span>&nbsp;target&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">InputSystem</span>.translate_contracts_lustre&nbsp;src&nbsp;target&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log_uncond&nbsp;<span class="string">"Success"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;<span class="keyword">with</span>&nbsp;e&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_error</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"Could&nbsp;not&nbsp;translate&nbsp;contracts&nbsp;from&nbsp;file&nbsp;\"%s\":@&nbsp;%s"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src&nbsp;(<span class="constructor">Printexc</span>.to_string&nbsp;e)<br>
&nbsp;&nbsp;)<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Kind2Flow</span>.run&nbsp;input_sys<br>
<br>
;;<br>
<br>
main&nbsp;()<br>
<br>
<span class="comment">(*&nbsp;<br>
&nbsp;&nbsp;&nbsp;Local&nbsp;Variables:<br>
&nbsp;&nbsp;&nbsp;compile-command:&nbsp;"make&nbsp;-C&nbsp;..&nbsp;-k"<br>
&nbsp;&nbsp;&nbsp;tuareg-interactive-program:&nbsp;"./kind2.top&nbsp;-I&nbsp;./_build&nbsp;-I&nbsp;./_build/SExpr"<br>
&nbsp;&nbsp;&nbsp;indent-tabs-mode:&nbsp;nil<br>
&nbsp;&nbsp;&nbsp;End:&nbsp;<br>
*)</span><br>
&nbsp;&nbsp;<br>
</code></body></html>