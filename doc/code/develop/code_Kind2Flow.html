<html><head>
<link rel="stylesheet" href="include/style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Log" rel="Chapter" href="Log.html">
<link title="Event" rel="Chapter" href="Event.html">
<link title="Strategy" rel="Chapter" href="Strategy.html">
<link title="Analysis" rel="Chapter" href="Analysis.html">
<link title="Flags" rel="Chapter" href="Flags.html">
<link title="InvarManager" rel="Chapter" href="InvarManager.html">
<link title="Kind2" rel="Chapter" href="Kind2.html">
<link title="Kind2Flow" rel="Chapter" href="Kind2Flow.html">
<link title="InputSystem" rel="Chapter" href="InputSystem.html">
<link title="Eval" rel="Chapter" href="Eval.html">
<link title="Ident" rel="Chapter" href="Ident.html">
<link title="Ltree" rel="Chapter" href="Ltree.html">
<link title="Model" rel="Chapter" href="Model.html">
<link title="Scope" rel="Chapter" href="Scope.html">
<link title="Simplify" rel="Chapter" href="Simplify.html">
<link title="StateVar" rel="Chapter" href="StateVar.html">
<link title="Symbol" rel="Chapter" href="Symbol.html">
<link title="TermAttr" rel="Chapter" href="TermAttr.html">
<link title="Term" rel="Chapter" href="Term.html">
<link title="Type" rel="Chapter" href="Type.html">
<link title="UfSymbol" rel="Chapter" href="UfSymbol.html">
<link title="Var" rel="Chapter" href="Var.html">
<link title="Property" rel="Chapter" href="Property.html">
<link title="SubSystem" rel="Chapter" href="SubSystem.html">
<link title="TransSys" rel="Chapter" href="TransSys.html">
<link title="Actlit" rel="Chapter" href="Actlit.html">
<link title="Base" rel="Chapter" href="Base.html">
<link title="Compress" rel="Chapter" href="Compress.html">
<link title="Step" rel="Chapter" href="Step.html">
<link title="Clause" rel="Chapter" href="Clause.html">
<link title="CooperQE" rel="Chapter" href="CooperQE.html">
<link title="Extract" rel="Chapter" href="Extract.html">
<link title="IC3" rel="Chapter" href="IC3.html">
<link title="Poly" rel="Chapter" href="Poly.html">
<link title="Presburger" rel="Chapter" href="Presburger.html">
<link title="QE" rel="Chapter" href="QE.html">
<link title="InvGenMiner" rel="Chapter" href="InvGenMiner.html">
<link title="InvGenDomain" rel="Chapter" href="InvGenDomain.html">
<link title="InvGenGraph" rel="Chapter" href="InvGenGraph.html">
<link title="InvGen" rel="Chapter" href="InvGen.html">
<link title="LockStepDriver" rel="Chapter" href="LockStepDriver.html">
<link title="InputParser" rel="Chapter" href="InputParser.html">
<link title="Interpreter" rel="Chapter" href="Interpreter.html">
<link title="LustreLexer" rel="Chapter" href="LustreLexer.html">
<link title="LustreParser" rel="Chapter" href="LustreParser.html">
<link title="LustreAst" rel="Chapter" href="LustreAst.html">
<link title="LustreIdent" rel="Chapter" href="LustreIdent.html">
<link title="LustreIndex" rel="Chapter" href="LustreIndex.html">
<link title="LustreExpr" rel="Chapter" href="LustreExpr.html">
<link title="LustreNode" rel="Chapter" href="LustreNode.html">
<link title="LustreContext" rel="Chapter" href="LustreContext.html">
<link title="LustreContract" rel="Chapter" href="LustreContract.html">
<link title="LustreDeclarations" rel="Chapter" href="LustreDeclarations.html">
<link title="LustreSimplify" rel="Chapter" href="LustreSimplify.html">
<link title="LustreSlicing" rel="Chapter" href="LustreSlicing.html">
<link title="LustreTransSys" rel="Chapter" href="LustreTransSys.html">
<link title="LustreInput" rel="Chapter" href="LustreInput.html">
<link title="LustrePath" rel="Chapter" href="LustrePath.html">
<link title="NativeInput" rel="Chapter" href="NativeInput.html">
<link title="Pretty" rel="Chapter" href="Pretty.html">
<link title="SMTExpr" rel="Chapter" href="SMTExpr.html">
<link title="SMTLIBSolver" rel="Chapter" href="SMTLIBSolver.html">
<link title="SMTSolver" rel="Chapter" href="SMTSolver.html">
<link title="SolverDriver" rel="Chapter" href="SolverDriver.html">
<link title="SolverResponse" rel="Chapter" href="SolverResponse.html">
<link title="SolverSig" rel="Chapter" href="SolverSig.html">
<link title="CVC4Driver" rel="Chapter" href="CVC4Driver.html">
<link title="GenericSMTLIBDriver" rel="Chapter" href="GenericSMTLIBDriver.html">
<link title="Z3Driver" rel="Chapter" href="Z3Driver.html">
<link title="Yices2SMT2Driver" rel="Chapter" href="Yices2SMT2Driver.html">
<link title="YicesDriver" rel="Chapter" href="YicesDriver.html">
<link title="YicesLexer" rel="Chapter" href="YicesLexer.html">
<link title="YicesNative" rel="Chapter" href="YicesNative.html">
<link title="YicesResponse" rel="Chapter" href="YicesResponse.html">
<link title="Debug" rel="Chapter" href="Debug.html">
<link title="Decimal" rel="Chapter" href="Decimal.html">
<link title="Hashcons" rel="Chapter" href="Hashcons.html">
<link title="HString" rel="Chapter" href="HString.html">
<link title="HStringSExpr" rel="Chapter" href="HStringSExpr.html">
<link title="Kind2Config" rel="Chapter" href="Kind2Config.html">
<link title="Lib" rel="Chapter" href="Lib.html">
<link title="Res" rel="Chapter" href="Res.html">
<link title="Messaging" rel="Chapter" href="Messaging.html">
<link title="Numeral" rel="Chapter" href="Numeral.html">
<link title="SExprBase" rel="Chapter" href="SExprBase.html">
<link title="SExprLexer" rel="Chapter" href="SExprLexer.html">
<link title="Stat" rel="Chapter" href="Stat.html">
<link title="TermLib" rel="Chapter" href="TermLib.html">
<link title="Trie" rel="Chapter" href="Trie.html">
<link title="Version" rel="Chapter" href="Version.html">
<link title="LustreToRust" rel="Chapter" href="LustreToRust.html">
<link title="TestgenDF" rel="Chapter" href="TestgenDF.html">
<link title="TestgenIO" rel="Chapter" href="TestgenIO.html">
<link title="TestgenModes" rel="Chapter" href="TestgenModes.html">
<link title="TestgenSolver" rel="Chapter" href="TestgenSolver.html">
<link title="TestgenStrategies" rel="Chapter" href="TestgenStrategies.html">
<link title="TestgenTree" rel="Chapter" href="TestgenTree.html">
<link title="TestgenLib" rel="Chapter" href="TestgenLib.html">
<link title="Certificate" rel="Chapter" href="Certificate.html"><title>Kind 2 Developer's Documentation : Kind2Flow</title>
</head>
<body>
<code class="code"><span class="comment">(*&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;Kind&nbsp;2&nbsp;model&nbsp;checker.

&nbsp;&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2015&nbsp;by&nbsp;the&nbsp;Board&nbsp;of&nbsp;Trustees&nbsp;of&nbsp;the&nbsp;University&nbsp;of&nbsp;Iowa

&nbsp;&nbsp;&nbsp;Licensed&nbsp;under&nbsp;the&nbsp;Apache&nbsp;License,&nbsp;Version&nbsp;2.0&nbsp;(the&nbsp;"License");&nbsp;you
&nbsp;&nbsp;&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.&nbsp;&nbsp;You
&nbsp;&nbsp;&nbsp;may&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at

&nbsp;&nbsp;&nbsp;http://www.apache.org/licenses/LICENSE-2.0&nbsp;

&nbsp;&nbsp;&nbsp;Unless&nbsp;required&nbsp;by&nbsp;applicable&nbsp;law&nbsp;or&nbsp;agreed&nbsp;to&nbsp;in&nbsp;writing,&nbsp;software
&nbsp;&nbsp;&nbsp;distributed&nbsp;under&nbsp;the&nbsp;License&nbsp;is&nbsp;distributed&nbsp;on&nbsp;an&nbsp;"AS&nbsp;IS"&nbsp;BASIS,
&nbsp;&nbsp;&nbsp;WITHOUT&nbsp;WARRANTIES&nbsp;OR&nbsp;CONDITIONS&nbsp;OF&nbsp;ANY&nbsp;KIND,&nbsp;either&nbsp;express&nbsp;or
&nbsp;&nbsp;&nbsp;implied.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing
&nbsp;&nbsp;&nbsp;permissions&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.&nbsp;

*)</span>

<span class="keyword">module</span>&nbsp;<span class="constructor">ISys</span>&nbsp;=&nbsp;<span class="constructor">InputSystem</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">Sys</span>&nbsp;=&nbsp;<span class="constructor">TransSys</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">Anal</span>&nbsp;=&nbsp;<span class="constructor">Analysis</span>

<span class="keyword">module</span>&nbsp;<span class="constructor">BMC</span>&nbsp;=&nbsp;<span class="constructor">Base</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">IND</span>&nbsp;=&nbsp;<span class="constructor">Step</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">IND2</span>&nbsp;=&nbsp;<span class="constructor">Step2</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">TestGen</span>&nbsp;=&nbsp;<span class="constructor">TestgenDF</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">C2I</span>&nbsp;=&nbsp;<span class="constructor">C2I</span>
<span class="keyword">module</span>&nbsp;<span class="constructor">C2Icnf</span>&nbsp;=&nbsp;<span class="constructor">C2Icnf</span>

<span class="keyword">module</span>&nbsp;<span class="constructor">Sig</span>&nbsp;=&nbsp;<span class="constructor">TermLib</span>.<span class="constructor">Signals</span>

<span class="keyword">open</span>&nbsp;<span class="constructor">Lib</span>
<span class="keyword">open</span>&nbsp;<span class="constructor">Res</span>

<span class="comment">(*&nbsp;|===|&nbsp;Helpers.&nbsp;*)</span>

</code><table><tr><td></td><td><span class="comment">(** Fold left on lists. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;fold&nbsp;=&nbsp;<span class="constructor">List</span>.fold_left
</code><table><tr><td></td><td><span class="comment">(** Iterator on lists. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;iter&nbsp;=&nbsp;<span class="constructor">List</span>.iter

</code><table><tr><td></td><td><span class="comment">(** Hide existential type parameter to construct values of <code class="code"><span class="keywordsign">'</span>a <span class="constructor">InputSystem</span>.t</code>
at runtime *)</span></td></tr></table><code class="code">
<span class="keyword">type</span>&nbsp;any_input&nbsp;=
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Input</span>&nbsp;:&nbsp;<span class="keywordsign">'</span>a&nbsp;<span class="constructor">InputSystem</span>.t&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;any_input


<span class="comment">(*&nbsp;|===|&nbsp;Post&nbsp;analysis&nbsp;stuff.&nbsp;*)</span>


</code><table><tr><td></td><td><span class="comment">(** Signature of modules for post-analysis treatment. *)</span></td></tr></table><code class="code">
<span class="keyword">module</span>&nbsp;<span class="keyword">type</span>&nbsp;<span class="constructor">PostAnal</span>&nbsp;=&nbsp;<span class="keyword">sig</span>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Indicates whether the module is active. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;is_active:&nbsp;unit&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;bool
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Performs the treatment. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;run:
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Input system. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">'</span>a&nbsp;<span class="constructor">ISys</span>.t&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Transition system. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.t&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Analysis parameter. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Anal</span>.param&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Results for the current system. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Anal</span>.result&nbsp;list
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Can fail. *)</span></td></tr></table><code class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;unit&nbsp;res
<span class="keyword">end</span>

</code><table><tr><td></td><td><span class="comment">(** Test generation. *)</span></td></tr></table><code class="code">
<span class="keyword">module</span>&nbsp;<span class="constructor">RunTestGen</span>:&nbsp;<span class="constructor">PostAnal</span>&nbsp;=&nbsp;<span class="keyword">struct</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;is_active&nbsp;()&nbsp;=&nbsp;<span class="constructor">Flags</span>.<span class="constructor">Testgen</span>.active&nbsp;()
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;run&nbsp;i_sys&nbsp;sys&nbsp;param&nbsp;results&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Err</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;fmt&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Format</span>.fprintf&nbsp;fmt&nbsp;<span class="string">"test&nbsp;generation&nbsp;is&nbsp;unimplemented"</span>
&nbsp;&nbsp;&nbsp;&nbsp;)
<span class="keyword">end</span>

</code><table><tr><td></td><td><span class="comment">(** Contract generation. *)</span></td></tr></table><code class="code">
<span class="keyword">module</span>&nbsp;<span class="constructor">RunContractGen</span>:&nbsp;<span class="constructor">PostAnal</span>&nbsp;=&nbsp;<span class="keyword">struct</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;is_active&nbsp;()&nbsp;=&nbsp;<span class="constructor">Flags</span>.<span class="constructor">Contracts</span>.contract_gen&nbsp;()
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;run&nbsp;i_sys&nbsp;sys&nbsp;param&nbsp;results&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Err</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;fmt&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Format</span>.fprintf&nbsp;fmt&nbsp;<span class="string">"contract&nbsp;generation&nbsp;unimplemented"</span>
&nbsp;&nbsp;&nbsp;&nbsp;)
<span class="keyword">end</span>

</code><table><tr><td></td><td><span class="comment">(** List of post-analysis modules. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;post_anal&nbsp;=&nbsp;[
&nbsp;&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">RunTestGen</span>:&nbsp;<span class="constructor">PostAnal</span>)&nbsp;;
&nbsp;&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">RunContractGen</span>:&nbsp;<span class="constructor">PostAnal</span>)&nbsp;;
]

</code><table><tr><td></td><td><span class="comment">(** Runs the post-analysis things on a system and its results. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;run_post_anal&nbsp;i_sys&nbsp;sys&nbsp;param&nbsp;results&nbsp;=
&nbsp;&nbsp;post_anal&nbsp;|&gt;&nbsp;l_iter&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">module</span>&nbsp;<span class="constructor">Module</span>&nbsp;=&nbsp;(<span class="keyword">val</span>&nbsp;m:&nbsp;<span class="constructor">PostAnal</span>)&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Module</span>.run&nbsp;i_sys&nbsp;sys&nbsp;param&nbsp;results
&nbsp;&nbsp;)


<span class="comment">(*&nbsp;|===|&nbsp;Helpers&nbsp;to&nbsp;run&nbsp;stuff.&nbsp;*)</span>

</code><table><tr><td></td><td><span class="comment">(** Child processes forked.
This is an association list of PID to process type. We need a
reference here, because we may need to terminate asynchronously
after an exception. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;child_pids&nbsp;=&nbsp;ref&nbsp;[]

</code><table><tr><td></td><td><span class="comment">(** Renices the current process. Used for invariant generation. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;renice&nbsp;()&nbsp;=
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nice&nbsp;=&nbsp;&nbsp;(<span class="constructor">Flags</span>.<span class="constructor">Invgen</span>.renice&nbsp;())&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;nice&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_info</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"[renice]&nbsp;ignoring&nbsp;negative&nbsp;niceness&nbsp;value."</span>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;nice&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nice'&nbsp;=&nbsp;<span class="constructor">Unix</span>.nice&nbsp;nice&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_info</span>&nbsp;<span class="string">"[renice]&nbsp;renicing&nbsp;to&nbsp;%d"</span>&nbsp;nice'

</code><table><tr><td></td><td><span class="comment">(** Main function of the process *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;main_of_process&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">IC3</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">IC3</span>.main
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">BMC</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">BMC</span>.main
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">IND</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">IND</span>.main
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">IND2</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">IND2</span>.main
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">INVGEN</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;renice&nbsp;()&nbsp;;&nbsp;<span class="constructor">InvGen</span>.main&nbsp;<span class="keyword">true</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">INVGENOS</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;renice&nbsp;()&nbsp;;&nbsp;<span class="constructor">InvGen</span>.main&nbsp;<span class="keyword">false</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">C2I</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;renice&nbsp;()&nbsp;;&nbsp;<span class="constructor">C2I</span>.main
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Interpreter</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Flags</span>.<span class="constructor">Interpreter</span>.input_file&nbsp;()&nbsp;|&gt;&nbsp;<span class="constructor">Interpreter</span>.main
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Supervisor</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">InvarManager</span>.main&nbsp;child_pids
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Parser</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Certif</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;_&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;()&nbsp;)

</code><table><tr><td></td><td><span class="comment">(** Cleanup function of the process *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;on_exit_of_process&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">IC3</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">IC3</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">BMC</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">BMC</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">IND</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">IND</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">IND2</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">IND2</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">INVGEN</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">InvGen</span>.exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">INVGENOS</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">InvGen</span>.exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">C2I</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">C2I</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Interpreter</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Interpreter</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Supervisor</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">InvarManager</span>.on_exit
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Parser</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Certif</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;ignore

</code><table><tr><td></td><td><span class="comment">(** Short name for a kind module. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;debug_ext_of_process&nbsp;=&nbsp;short_name_of_kind_module

<span class="comment">(*&nbsp;Decides&nbsp;what&nbsp;the&nbsp;exit&nbsp;status&nbsp;is&nbsp;by&nbsp;looking&nbsp;at&nbsp;a&nbsp;transition&nbsp;system.

The&nbsp;exit&nbsp;status&nbsp;is
*&nbsp;0&nbsp;if&nbsp;some&nbsp;properties&nbsp;are&nbsp;unknown&nbsp;or&nbsp;k-true&nbsp;(timeout),
*&nbsp;10&nbsp;if&nbsp;some&nbsp;properties&nbsp;are&nbsp;falsifiable&nbsp;(unsafe),
*&nbsp;20&nbsp;if&nbsp;all&nbsp;properties&nbsp;are&nbsp;invariants&nbsp;(safe).&nbsp;*)</span>
<span class="keyword">let</span>&nbsp;status_of_trans_sys&nbsp;sys&nbsp;=
&nbsp;&nbsp;<span class="comment">(*&nbsp;Checking&nbsp;if&nbsp;some&nbsp;properties&nbsp;are&nbsp;unknown&nbsp;of&nbsp;falsifiable.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;unknown,&nbsp;falsifiable&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">TransSys</span>.get_prop_status_all_nocands&nbsp;sys
&nbsp;&nbsp;&nbsp;&nbsp;|&gt;&nbsp;<span class="constructor">List</span>.fold_left&nbsp;(<span class="keyword">fun</span>&nbsp;(u,f)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(n,&nbsp;<span class="constructor">Property</span>.<span class="constructor">PropUnknown</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(n,&nbsp;<span class="constructor">Property</span>.<span class="constructor">PropKTrue</span>&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Format</span>.eprintf&nbsp;<span class="string">"%s&nbsp;KU@."</span>&nbsp;n;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u+1,f
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(n,&nbsp;<span class="constructor">Property</span>.<span class="constructor">PropFalse</span>&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Format</span>.eprintf&nbsp;<span class="string">"%s&nbsp;FALSE@."</span>&nbsp;n;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u,f+1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;u,f
&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;(0,0)
&nbsp;&nbsp;&nbsp;&nbsp;|&gt;&nbsp;<span class="keyword">fun</span>&nbsp;(u,f)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;u&nbsp;&gt;&nbsp;0,&nbsp;f&nbsp;&gt;&nbsp;0
&nbsp;&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Getting&nbsp;relevant&nbsp;exit&nbsp;code.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;exit_status&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;unknown&nbsp;<span class="keyword">then</span>&nbsp;<span class="constructor">ExitCodes</span>.unknown&nbsp;<span class="keyword">else</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;falsifiable&nbsp;<span class="keyword">then</span>&nbsp;<span class="constructor">ExitCodes</span>.unsafe
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">ExitCodes</span>.safe
&nbsp;&nbsp;&nbsp;&nbsp;)
&nbsp;&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Exit&nbsp;status.&nbsp;*)</span>
&nbsp;&nbsp;exit_status

</code><table><tr><td></td><td><span class="comment">(** Exit status from an optional <code class="code">results</code>. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;status_of_sys&nbsp;sys_opt&nbsp;=&nbsp;<span class="keyword">match</span>&nbsp;sys_opt&nbsp;<span class="keyword">with</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"result&nbsp;analysis:&nbsp;no&nbsp;system&nbsp;found"</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Format</span>.eprintf&nbsp;<span class="string">"NO_SYS@."</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">ExitCodes</span>.unknown
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;sys&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;status_of_trans_sys&nbsp;sys

</code><table><tr><td></td><td><span class="comment">(** Exit status from an optional <code class="code">results</code>. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;status_of_results&nbsp;results_opt&nbsp;=&nbsp;<span class="keyword">match</span>&nbsp;results_opt&nbsp;<span class="keyword">with</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"result&nbsp;analysis:&nbsp;no&nbsp;system&nbsp;found"</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Format</span>.eprintf&nbsp;<span class="string">"NO_RES@."</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">ExitCodes</span>.unknown
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;results&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;<span class="constructor">Analysis</span>.results_is_safe&nbsp;results&nbsp;<span class="keyword">with</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"result&nbsp;analysis:&nbsp;no&nbsp;safe&nbsp;result"</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Format</span>.eprintf&nbsp;<span class="string">"NO_SAFE_RES@."</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">ExitCodes</span>.unknown
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">ExitCodes</span>.safe
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">ExitCodes</span>.unsafe
&nbsp;&nbsp;)

<span class="comment">(*&nbsp;Return&nbsp;the&nbsp;status&nbsp;code&nbsp;from&nbsp;an&nbsp;exception&nbsp;*)</span>
<span class="keyword">let</span>&nbsp;status_of_exn&nbsp;process&nbsp;status&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Normal&nbsp;termination.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Exit</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;status
&nbsp;&nbsp;<span class="comment">(*&nbsp;Got&nbsp;unknown,&nbsp;issue&nbsp;error&nbsp;but&nbsp;normal&nbsp;termination.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">SMTSolver</span>.<span class="constructor">Unknown</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_error</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"@[&lt;v&gt;In&nbsp;%a:&nbsp;a&nbsp;check-sat&nbsp;resulted&nbsp;in&nbsp;\"unknown\".@&nbsp;This&nbsp;is&nbsp;most&nbsp;likely&nbsp;due&nbsp;to&nbsp;non-linear&nbsp;expressions&nbsp;in&nbsp;the&nbsp;model,@&nbsp;usually&nbsp;multiplications&nbsp;`v_1&nbsp;*&nbsp;v_2`&nbsp;or&nbsp;divisions&nbsp;`v_1&nbsp;/&nbsp;v_2`.@&nbsp;Consider&nbsp;running&nbsp;Kind&nbsp;2&nbsp;with&nbsp;`--smt_check_sat_assume&nbsp;off`&nbsp;or@&nbsp;abstracting&nbsp;non-linear&nbsp;expressions&nbsp;using&nbsp;contracts.@]"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp_print_kind_module&nbsp;process&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;status
&nbsp;&nbsp;<span class="comment">(*&nbsp;Termination&nbsp;message.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Event</span>.<span class="constructor">Terminate</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_debug</span>&nbsp;<span class="string">"Received&nbsp;termination&nbsp;message"</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;status
&nbsp;&nbsp;<span class="comment">(*&nbsp;Catch&nbsp;wallclock&nbsp;timeout.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">TimeoutWall</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log_timeout&nbsp;<span class="keyword">true</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;status
&nbsp;&nbsp;<span class="comment">(*&nbsp;Catch&nbsp;CPU&nbsp;timeout.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">TimeoutVirtual</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log_timeout&nbsp;<span class="keyword">false</span>&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;status
&nbsp;&nbsp;<span class="comment">(*&nbsp;Signal&nbsp;caught.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Signal</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log_interruption&nbsp;s&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Return&nbsp;exit&nbsp;status&nbsp;and&nbsp;signal&nbsp;number.&nbsp;*)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">ExitCodes</span>.kid_status&nbsp;+&nbsp;s
&nbsp;&nbsp;<span class="comment">(*&nbsp;Runtime&nbsp;failure.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Failure</span>&nbsp;msg&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"Runtime&nbsp;failure&nbsp;in&nbsp;%a:&nbsp;%s"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp_print_kind_module&nbsp;process&nbsp;msg&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">ExitCodes</span>.error
&nbsp;&nbsp;<span class="comment">(*&nbsp;Other&nbsp;exception,&nbsp;return&nbsp;exit&nbsp;status&nbsp;for&nbsp;error.&nbsp;*)</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;e&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Event</span>.log&nbsp;<span class="constructor">L_fatal</span>&nbsp;<span class="string">"Runtime&nbsp;error&nbsp;in&nbsp;%a:&nbsp;%s"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp_print_kind_module&nbsp;process&nbsp;(<span class="constructor">Printexc</span>.to_string&nbsp;e)&nbsp;;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">ExitCodes</span>.error

</code><table><tr><td></td><td><span class="comment">(** Status corresponding to an exception based on an optional system. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;status_of_exn_sys&nbsp;process&nbsp;sys_opt&nbsp;=
&nbsp;&nbsp;status_of_exn&nbsp;process&nbsp;(status_of_sys&nbsp;sys_opt)

</code><table><tr><td></td><td><span class="comment">(** Status corresponding to an exception based on some results. *)</span></td></tr></table><code class="code">
<span class="keyword">let</span>&nbsp;status_of_exn_results&nbsp;process&nbsp;results_opt&nbsp;=
&nbsp;&nbsp;status_of_exn&nbsp;process&nbsp;(status_of_results&nbsp;results_opt)


<span class="comment">(*&nbsp;
&nbsp;&nbsp;&nbsp;Local&nbsp;Variables:
&nbsp;&nbsp;&nbsp;compile-command:&nbsp;"make&nbsp;-C&nbsp;..&nbsp;-k"
&nbsp;&nbsp;&nbsp;tuareg-interactive-program:&nbsp;"./kind2.top&nbsp;-I&nbsp;./_build&nbsp;-I&nbsp;./_build/SExpr"
&nbsp;&nbsp;&nbsp;indent-tabs-mode:&nbsp;nil
&nbsp;&nbsp;&nbsp;End:&nbsp;
*)</span></code></body></html>