# DO NOT CHANGE THIS FILE!
# If you want to change the Makefile, edit Makefile.in instead

# @configure_input@

LOCAL_BINDIR=$(CURDIR)/bin
LOCAL_DOCDIR=$(CURDIR)/ocamldoc
LOCAL_REGRESSIONDIR=$(CURDIR)/tests/regression
LOCAL_ALLDOCDIR=$(CURDIR)/doc
LOCAL_USRDOCDIR=$(CURDIR)/doc/usr

package=@PACKAGE_NAME@
version=@PACKAGE_VERSION@
tarname=@PACKAGE_TARNAME@
distdir=$(tarname)-$(version).`date +%Y.%m.%d`

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
bin_suffix=@bin_suffix@

install_files=@PACKAGE_NAME@

all: @PACKAGE_NAME@

.PHONY: ocamlczmq @PACKAGE_NAME@ @PACKAGE_NAME@-prof @PACKAGE_NAME@-top @PACKAGE_NAME@-doc 

ocamlczmq: 
	cd ocamlczmq && ./build.sh

@PACKAGE_NAME@: 
	make -C src
	mkdir -p $(LOCAL_BINDIR)
	cp -f src/_build/@PACKAGE_NAME@.native $(LOCAL_BINDIR)/$@

@PACKAGE_NAME@-prof: 
	make -C src $@
	mkdir -p $(LOCAL_BINDIR)
	cp -f src/_build/@PACKAGE_NAME@.native $(LOCAL_BINDIR)/$@

@PACKAGE_NAME@-top: 
	make -C src $@
	mkdir -p $(LOCAL_BINDIR)
	cp -f src/_build/@PACKAGE_NAME@.top $(LOCAL_BINDIR)/$@

@PACKAGE_NAME@-terms-top: 
	make -C src $@
	mkdir -p $(LOCAL_BINDIR)
	cp -f src/_build/@PACKAGE_NAME@-terms.top $(LOCAL_BINDIR)/$@

lustre-checker: 
	make -C src $@
	mkdir -p $(LOCAL_BINDIR)
	cp -f src/_build/lustreChecker.native $(LOCAL_BINDIR)/$@

@PACKAGE_NAME@-doc: 
	make -C src $@
	mkdir -p $(LOCAL_DOCDIR)
	cp -Rf src/_build/@PACKAGE_NAME@.docdir/* $(LOCAL_DOCDIR)

.PHONY: install clean-@PACKAGE_NAME@ clean-ocamlczmq clean test doc

install: 
	mkdir -p ${bindir}
	for i in $(install_files); do \
		install -m 0755 $(addprefix $(LOCAL_BINDIR)/,$$i) $(addsuffix ${bin_suffix},$(addprefix ${bindir}/,$$i)); \
	 done
	if [ -n ${bin_suffix} ]; then echo "Suffix for binaries is ${bin_suffix}"; fi

test: all
	./tests/run.sh $(LOCAL_REGRESSIONDIR) $(LOCAL_BINDIR)/kind2 "${ARGS}"

doc:
	make -C $(LOCAL_USRDOCDIR)
	cp $(LOCAL_USRDOCDIR)/doc.pdf $(LOCAL_ALLDOCDIR)/user_documentation.pdf

doc-sync:
	make -C $(LOCAL_USRDOCDIR) update

doc-clean:
	make -C $(LOCAL_USRDOCDIR) clean

clean-@PACKAGE_NAME@:
	make -C src clean

clean-ocamlczmq:
	make -C ocamlczmq clean
	rm -f $(LOCAL_ALLDOCDIR)/*.pdf

clean: clean-@PACKAGE_NAME@ clean-ocamlczmq doc-clean



.PHONY: release git-add-autogenerated

# Files produced by autogen.sh that are needed by build.sh
AUTOGEN_FILES=configure \
	      ocamlczmq/configure \
	      ocamlczmq/czmq/aclocal.m4		\
	      ocamlczmq/czmq/Makefile.in		\
	      ocamlczmq/czmq/config/compile				\
	      ocamlczmq/czmq/config/config.guess			\
	      ocamlczmq/czmq/config/config.sub				\
	      ocamlczmq/czmq/config/depcomp				\
	      ocamlczmq/czmq/config/install-sh				\
	      ocamlczmq/czmq/config/ltmain.sh				\
	      ocamlczmq/czmq/config/missing				\
	      ocamlczmq/czmq/config/test-driver				\
	      ocamlczmq/czmq/configure                                  \
              ocamlczmq/czmq/doc/Makefile.in	                        \
	      ocamlczmq/czmq/model/Makefile.in				\
	      ocamlczmq/czmq/src/libczmq.pc.in                          \
	      ocamlczmq/czmq/src/Makefile.in				\
	      ocamlczmq/czmq/src/platform.h.in                          \
	      ocamlczmq/zeromq/aclocal.m4		\
	      ocamlczmq/zeromq/Makefile.in				\
	      ocamlczmq/zeromq/builds/msvc/Makefile.in			\
	      ocamlczmq/zeromq/config/compile				\
	      ocamlczmq/zeromq/config/config.guess			\
	      ocamlczmq/zeromq/config/config.sub			\
	      ocamlczmq/zeromq/config/depcomp				\
	      ocamlczmq/zeromq/config/install-sh			\
	      ocamlczmq/zeromq/config/ltmain.sh				\
	      ocamlczmq/zeromq/config/missing				\
	      ocamlczmq/zeromq/config/test-driver			\
	      ocamlczmq/zeromq/doc/Makefile.in				\
	      ocamlczmq/zeromq/foreign/openpgm/Makefile.in		\
	      ocamlczmq/zeromq/perf/Makefile.in				\
	      ocamlczmq/zeromq/src/Makefile.in				\
	      ocamlczmq/zeromq/src/platform.hpp.in			\
	      ocamlczmq/zeromq/tests/Makefile.in			\
	      ocamlczmq/zeromq/configure \
	      ocamlczmq/czmq/addons/Makefile.in					

$(AUTOGEN_FILES): 
	git add -f $@

git-add-autogenerated: $(AUTOGEN_FILES)

release: git-add-autogenerated


# Remake this Makefile if configuration has changed 
Makefile: Makefile.in ./config.status
	./config.status

./config.status: ./configure
	./config.status --recheck

